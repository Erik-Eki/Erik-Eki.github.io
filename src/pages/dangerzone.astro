---
//import Button from './Button.astro';

import "../styles/global.css";

// Welcome to Astro! Everything between these triple-dash code fences
// is your "component front matter". It never runs in the browser.
console.log("This runs in your terminal, not the browser!");

// Import a single file
import { Content as CodeExample } from "../pages/code-example.md";

import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";

const pageTitle = "Danger Zone";
const pageSubtitle = "This page is for those who are craaaaazyyyyyyyy!";
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svgxml" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>Astro</title>
    <style>
      h1 {
        color: black;
      }
    </style>
  </head>
  <body>
    <Header />

    <h1>{pageTitle}</h1>

    <pre>{pageSubtitle}</pre>

    <!-- <form
      method="post"
      action="https://api.openai.com/v1/completions"
      style={{ display: "flex", flexDirection: "column", padding: 10, color: "red" }}
    >
      <input
        type="text"
        name="prompt"
        value="The quick brown fox jumps over the lazy dog"
      />
      <input type="text" name="max_tokens" value="50" />
      <input type="text" name="temperature" value="0.7" />
      <input type="text" name="top_p" value="0.9" />
      <input type="text" name="n" value="3" />
      <input type="text" name="stream" value="false" />
      <input type="text" name="logprobs" value="0" />
      <input type="text" name="stop" value="." />
      <input type="text" name="presence_penalty" value="0.0" />
      <input type="text" name="frequency_penalty" value="0.0" />
      <input type="text" name="frequency_reward" value="0.0" />
      <input type="text" name="presence_reward" value="0.0" />
      <input type="text" name="repetition_penalty" value="1.0" />
      <input type="text" name="temperature_tuning" value="0.0" />
      <input type="text" name="top_p_tuning" value="0.0" />
      <input type="text" name="n_tuning" value="0.0" />
      <input type="text" name="repetition_penalty_tuning" value="0.0" />
    </form> -->

    
    <div>Prompt:</div>
    <input type="text" placeholder="Type something..." id="prompt-field"/>
    <button type="button" id="send-button">Send</button>
    <!-- <form
        action="javascript:sendResponse()"
    >
    <button type="submit">
        Send
    </button>
    </form> -->

    <h2>Response</h2>
    <pre id="output">
    Response appears here.
    </pre>

    <h3>Raw output</h3>
    <pre
      id="raw-output">
    No data here yet...
      <!-- {JSON.stringify(data, null, 2)} -->
    </pre>
    <!-- <p>Post Archive:</p>
    <ul>
    {posts.map(post => <li><a href={post.url}>{post.frontmatter.title}</a></li>)}
    </ul> -->
    <Footer />

    <script>

      async function sendResponse() {
        const prompt = document.getElementById("prompt-field").value;
        //(<HTMLInputElement>document.getElementById("prompt-field")).value;
        //document.getElementById("prompt-field").value;

        const dataToSend = JSON.stringify({
            model: "text-davinci-003",
            prompt: prompt,
            max_tokens: 100,
            temperature: 0,
            // "top_p": 1,
            // "n": 1,
            // "stream": false,
            // "logprobs": null,
            //"stop": "\n"
        });

        const response = await fetch("https://api.openai.com/v1/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization:
              "Bearer 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",
          },
          body: dataToSend,
        });

        const data = await response.json();

        const formatted = data["choices"][0]["text"]

        document.getElementById("output").innerHTML = formatted
        document.getElementById("raw-output").innerHTML = JSON.stringify(data, null, 2)
      }

      document
        .getElementById("send-button")
        .addEventListener("click", sendResponse);
    </script>
  </body>
</html>
